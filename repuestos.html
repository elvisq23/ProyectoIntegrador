<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="_layout">
    <head>
        <title>UTP Integrador - Repuestos</title>
    </head>
<body>
    <div th:fragment="content" id="repuestosApp" class="container mt-4">
        <h1>Gestión de Repuestos</h1>

        <div class="mb-3">
            <input type="text" class="form-control" placeholder="Buscar por Nombre o Descripción..." v-model="searchQuery" @input="debouncedSearch">
        </div>

        <p class="text-end">
            <button class="btn btn-primary" @click="nuevoRepuesto">Nuevo Repuesto</button>
        </p>

        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Precio Unitario</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="repuesto in repuestos" :key="repuesto.id">
                    <td>{{repuesto.id}}</td>
                    <td>{{repuesto.nombre}}</td>
                    <td>{{repuesto.descripcion}}</td>
                    <td>{{repuesto.precioUnitario | formatCurrency}}</td>
                    <td>{{repuesto.stock}}</td>
                    <td class="text-end">
                        <button class="btn btn-info me-2" @click="editarRepuesto(repuesto.id)" title="Editar">
                            <i class="bi bi-pencil-square"></i> </button>
                        <button class="btn btn-danger" @click="eliminarRepuesto(repuesto.id)" title="Eliminar">
                            <i class="bi bi-trash"></i> </button>
                    </td>
                </tr>
                <tr v-if="repuestos.length === 0">
                    <td colspan="6" class="text-center">No hay repuestos registrados o no se encontraron resultados.</td>
                </tr>
            </tbody>
        </table>

        <div class="modal fade" tabindex="-1" id="mdlRepuesto" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle" v-if="repuesto.id == null || repuesto.id == 0">Nuevo Repuesto</h5>
                        <h5 class="modal-title" id="modalTitle" v-else>Editar Repuesto</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3 row">
                            <label for="nombre" class="col-sm-4 col-form-label">Nombre</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="nombre" v-model="repuesto.nombre" required />
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="descripcion" class="col-sm-4 col-form-label">Descripción</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="descripcion" v-model="repuesto.descripcion" />
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="precioUnitario" class="col-sm-4 col-form-label">Precio Unitario</label>
                            <div class="col-sm-8">
                                <input type="number" step="0.01" class="form-control" id="precioUnitario" v-model.number="repuesto.precioUnitario" required />
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="stock" class="col-sm-4 col-form-label">Stock</label>
                            <div class="col-sm-8">
                                <input type="number" class="form-control" id="stock" v-model.number="repuesto.stock" required min="0" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" v-if="repuesto.id == null || repuesto.id == 0" @click="guardarActualizarRepuesto">Guardar</button>
                        <button type="button" class="btn btn-primary" v-else @click="guardarActualizarRepuesto">Actualizar</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" tabindex="-1" id="mdlEliminar" aria-labelledby="deleteModalTitle" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalTitle">Eliminar Repuesto</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        ¿Estás seguro que quieres eliminar este repuesto?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" @click="confirmarEliminacion">Eliminar</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:fragment="script"></script>
</body>
</html>