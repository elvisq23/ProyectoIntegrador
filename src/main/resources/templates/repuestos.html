<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="_layout">
    <head>
        <title>UTP Integrador - Repuestos</title>
    </head>
<body>
    <div th:fragment="content" id="repuestosApp" class="container mt-4">
        
        <div class="card card-body mb-4">
            <h4>Registrar Nuevo Repuesto</h4>
            <p class="text-muted">Utilice este formulario para registrar un nuevo repuesto en el inventario.</p>
            <form @submit.prevent="guardarNuevoRepuesto">
                <div class="mb-3">
                    <label for="nombreNuevo" class="form-label">Nombre</label>
                    <input id="nombreNuevo" class="form-control" v-model="nuevoRepuesto.nombre" required />
                </div>
                <div class="mb-3">
                    <label for="descripcionNuevo" class="form-label">Descripción</label>
                    <input id="descripcionNuevo" class="form-control" v-model="nuevoRepuesto.descripcion" />
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="precioNuevo" class="form-label">Precio Unitario</label>
                        <input id="precioNuevo" type="number" step="0.01" class="form-control" v-model.number="nuevoRepuesto.precioUnitario" required min="0"/>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="stockNuevo" class="form-label">Stock Inicial</label>
                        <input id="stockNuevo" type="number" class="form-control" v-model.number="nuevoRepuesto.stock" required min="0" />
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Agregar Repuesto</button>
            </form>
        </div>

        <hr>

        <div class="d-flex justify-content-between align-items-center">
            <h5>Stock Actual de Repuestos</h5>
            <div class="w-50">
                 <input type="text" class="form-control" placeholder="Buscar por Nombre o Descripción..." v-model="searchQuery" @input="debouncedSearch">
            </div>
        </div>

        <table class="table table-striped table-bordered mt-3">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Precio Unitario</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="repuesto in repuestos" :key="repuesto.id">
                    <td>{{repuesto.id}}</td>
                    <td>{{repuesto.nombre}}</td>
                    <td>{{repuesto.descripcion}}</td>
                    <td>{{repuesto.precioUnitario | formatCurrency}}</td>
                    <td>{{repuesto.stock}}</td>
                    <td class="text-end">
                        <button class="btn btn-info me-2" @click="editarRepuesto(repuesto.id)" title="Editar">
                            <i class="bi bi-pencil-square"></i> </button>
                        <button class="btn btn-danger" @click="eliminarRepuesto(repuesto.id)" title="Eliminar">
                            <i class="bi bi-trash"></i> </button>
                    </td>
                </tr>
                <tr v-if="repuestos.length === 0">
                    <td colspan="6" class="text-center">No hay repuestos registrados o no se encontraron resultados.</td>
                </tr>
            </tbody>
        </table>

        <div class="modal fade" tabindex="-1" id="mdlRepuesto" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle">Editar Repuesto</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" @click="guardarActualizarRepuesto">Actualizar</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal fade" tabindex="-1" id="mdlEliminar">
            </div>
    </div>

    <script th:fragment="script">
        const API_REPUESTOS_URL = '/api/repuestos';

        // ... (resto del script sin cambios) ...

        const RepuestosAppConfig = {
            data: {
                repuestos: [],
                nuevoRepuesto: {
                    nombre: '',
                    descripcion: '',
                    precioUnitario: 0.0,
                    stock: 0
                },
                repuesto: { id: null, nombre: '', descripcion: '', precioUnitario: 0.0, stock: 0 },
                searchQuery: '',
                idToDelete: null
            },
            methods: {
                listarRepuestos() { /* ... */ },
                guardarNuevoRepuesto() {
                    this.$http.post(API_REPUESTOS_URL, this.nuevoRepuesto).then(response => {
                        alert('Repuesto agregado con éxito!');
                        this.nuevoRepuesto = { nombre: '', descripcion: '', precioUnitario: 0.0, stock: 0 };
                        this.listarRepuestos();
                    }).catch(error => {
                        alert('Error al guardar el repuesto.');
                    });
                },
                editarRepuesto(id) { /* ... */ },
                guardarActualizarRepuesto() { /* ... */ },
                eliminarRepuesto(id) { /* ... */ },
                confirmarEliminacion() { /* ... */ },
                // ...
            },
            // ...
        };
    </script>
</body>
</html>